
printstr"1653 N $str"{AO(1>*1?idstr20){AL(30*31idstr32){ABCL:ifputch49(4>CL);ifputch5<(61CL);AA;AD:ifputch82(87*88idstr89);AA;}9>idstr:2CD:5;}::}:<
putl"1833 N $l"base"{ENEAijtemp_long31;cidstr44[47CL];cicch56;ENEAibj69=6:CM;ENEAidend7==80CM;DB(89ibl8:BL8;CM){idstr95[98CM]=9;CP;idstr:3[:6CL]=:9CP;};1DC{AO(<4ibl<5><6CM){ijtemp_long=1==:ibl=;%=<iebase==;DB(>:ijtemp_long>;<?4CL)idstr?=[A@@idendA@ACDA@D]=A@Gijtemp_longA@H+AAACP;DCidstrABC[ABFidendABGCDABJ]=ABMijtemp_longABN-ACGCL+ACJCP;iblADFBAADGiebaseADI;}AEAAG(AKGibjAKH=AKICM;ibjAKM<AKN(AKOidendAL@CAALCCL);ibjALICDALJ){icchAME=AMGidstrAMH[AMKibjAML];idstrANC[ANFibjANG]=ANIidstrANJ[ANMidendANN-AOA(AOBibjAOC+AODCL)];idstrAOM[B@@idendB@A-B@D(B@EibjB@F+B@GCL)]=B@KicchB@L;}BABidstrBAG[BAJidendBAK]=BAOCP;}BBGiiprintstrBBJ(BCBidstrBCC);}BCI
print_error"2696 N $errno"errors"emit_noerror"{ENEAibi5;;AG(>7ibi>8=>9CM;(>=(>>iferrno>?BM?4igerrors?6[?<ibi?=].iferrnoA@@)BKA@G(A@JibiA@K<A@LinN_DISK_ERRORSA@M));ibiAANCDAAO);DB(ABJiferrnoABK){iiprintstrACG(ACOs);ieputlADO(AECiferrnoAED,AEICL);iiprintstrAFD(AFLs);}AGEDB(AGL(AGM!AGNiferrnoAGO)BKAHF(AHI!AHJimemit_noerrorAHK))AK(AJBiferrnoAJC);iiprintstrAJN(AKFigerrorsAKG[AKMibiAKN].ijerror_msgALA);iiprintstrALN(AMFs);AK(ANFiferrnoANG);}ANO
LBA_to_CHS"3199 N $sector"chs_geometry"{imchs_geometry43p4?igsector51=57igsector58%5>(5?indisk_geometry60.igsector6>);imchs_geometry78p84iehead86=8:igsector8;/91indisk_geometry92.igsector:0;imchs_geometry:9p;5iicylinder;7=;?imchs_geometry<0p<<iehead<>/=2indisk_geometry=3.iehead>1;imchs_geometry>8p?4iehead?6BB?:indisk_geometry?<.ieheadA@J;AK(AAGCM);}AAL
read_kernel"3490 N $"{ENEAibi24,25ihsectors27,2>iocurrent_sector30,3>ikbuffer_seg40;ENEAipsectors_per_bar5<;ENc*7=ikkernel_ptr7>;ENc*9:ikbuffer_ptr9;;EIiigeometry:?ikchs_offset;9;niderr<>;iocurrent_sector=5=>3imloader_setup>4.imkernel_start?1;ikbuffer_segA@A=A@KimLOAD_BUF_SEGA@L;ikkernel_ptrAAK=ABE(ABFENc*ACE)ikKERNEL_LINACG;ikbuffer_ptrADD=ADN(ADOENc*AEN)(AF@imLOAD_BUF_SEGAFABPAFMCL);ihsectorsAGE=AGLimloader_setupAGM.iokernel_sectorsAHJ;ipsectors_per_barAIL=AJKihsectorsAJL/AKCCL+AKFCL;AO(ALBihsectorsALCBOALJ(ALLiocurrent_sectorALM-AMKimloader_setupAML.imkernel_startANI)){ikLBA_to_CHSAOM(B@Giocurrent_sectorB@H,BAF&BAHikchs_offsetBAI);iderrBBH=BBKisdisk_read_standardBBL(BCNimloader_setupBCO.ikboot_driveBDL,BEFikchs_offsetBF@.iicylinderBFK,BGCikchs_offsetBGM.ieheadBHH,BHLikchs_offsetBIF.igsectorBJA,BJGCL,BKBikbuffer_segBKL);DB(BLNiderrBLO)AK(BMNiderrBMO);iiprintstrBNH(BO@s);ibiC@A=C@BCM;AO(C@MibiC@N<C@OihsectorsCA@){DB(CBCibiCBDBNCBE(CBGiocurrent_sectorCBH-CCFimloader_setupCCG.imkernel_startCDD))iiprintstrCEG(CEOs);DCiiprintstrCGB(CGJs);ibiCHEBCCHFipsectors_per_barCHH;}CIKiiprintstrCJ@(CJHs);ieputlCKD(CKH(CKI(CKJ(CKK(CKLiocurrent_sectorCKM-CLKimloader_setupCLL.imkernel_startCMI)BPCNFCL)/CNJihsectorsCNK)*COCCL)CACOHCL,COKCL);iiprintstrD@E(D@Ms);iocurrent_sectorDAGBCDBECL;AG(DCAibiDCB=DCCCM;ibiDCG<DCHCL;ibiDCNCDDCO){*DDJikkernel_ptrDDK=DEEikbuffer_ptrDEF[DF@ibiDFA];ikkernel_ptrDFHCDDGB;}DGH}DGKiiprintstrDGN(DHFs);AK(DIHCM);}DIN
dump_mem"4825 N $ptr"bytes"{ENEAibi43;nibj4>;cicch59;EHcidhex6>[71]=74s;AG(91ibi92=93CM;ibi97<98ifbytes99;ibi:0CD:1){DB(;3!;4(;5ibi;6%;7CL)){AG(=8ibj=9==:CL;ibj=?BO>0CM;ibj>5BD>6CL)ifputch?;(A@@idhexA@A[A@D(A@E(A@FibiA@G+A@H(A@IENEA)idptrAAH)CAAALibjAAN)&ABACL]);ifputchACH(ACMCP);ifputchAE@(AEECP);}AFDicchAFO=AGAidptrAGB[AGEibiAGF];ifputchAHB(AHGidhexAHH[AHK(AHLicchAHMCAAHOCL)&AIDCL]);ifputchAJF(AJKidhexAJL[AJOicchAK@&AKCCL]);DB(AMA!AMB(AMC(AMDibiAME+AMFCL)%AMICL))ifputchANK(AO@CP);DB(B@B!B@C(B@D(B@EibiB@F+B@GCL)%B@JCL))iiprintstrBAD(BALs);}BBEiiprintstrBBH(BC@s);}BCH
is_monochrome"5401 N $"{ENc*25ikmonochrome26=31(33ENc*42)(44CL);AK(56(57(58*59ikmonochrome5:)CA66CL)&6<CL);}75
get_height"5525 N $"{ENc*22igheight23=2:(2<ENc*3;)(3=CL);AK(4?(50*51igheight52)+59CL);}5>
detect_video"5626 N $screen_setup"{ENnikvideo_type3?;ENnilvideo_state59;ikvideo_type69=73imbasic_detect74(80);AL(8;ikvideo_type8<){ABioVIDEO_TYPE_CGA:2:imscreen_setup;2p;>ietype<0[<4CM]=<7CP;imscreen_setup=5p>1ietype>3[>7CL]=>:CP;imscreen_setup?8pA@DietypeA@F[A@JCL]=A@MCP;imscreen_setupAAKpABGietypeABI[ABMCL]=AC@CP;AA;ABioVIDEO_TYPE_EGAADM:imscreen_setupAEMpAFIietypeAFK[AFOCM]=AGBCP;imscreen_setupAH@pAHLietypeAHN[AIBCL]=AIECP;imscreen_setupAJCpAJOietypeAKA[AKECL]=AKHCP;imscreen_setupALFpAMBietypeAMD[AMHCL]=AMKCP;AA;ABioVIDEO_TYPE_VGAAOH:imscreen_setupB@HpBADietypeBAF[BAJCM]=BAMCP;imscreen_setupBBKpBCGietypeBCI[BCMCL]=BD@CP;imscreen_setupBDNpBEJietypeBEL[BF@CL]=BFCCP;imscreen_setupBGApBGMietypeBGO[BHCCL]=BHFCP;AA;}BIMDB(BJD(BJEikvideo_typeBJFBLBK@ioVIDEO_TYPE_EGABKB)BJBLB(BLEikvideo_typeBLFBLBM@ioVIDEO_TYPE_VGABMB)){imscreen_setupBNHpBODikmonochromeBOF=C@@inis_monochromeC@A(C@N);ilvideo_stateCAE=CB@ijget_stateCBA(CBJ);imscreen_setupCC@pCCLiemodeCCN=CDBilvideo_stateCDC&CDOCL;imscreen_setupCEIpCFEifres_xCFG=CFL(CFMilvideo_stateCFNCACGJCL)&CH@CL;imscreen_setupCHJpCIFiepageCIH=CIL(CIMilvideo_stateCINCACJJCL)&CKACL;imscreen_setupCKLpCLHieaddrCLJ=CLNCL;imscreen_setupCMKpCNGifres_yCNI=CNNikget_heightCNO(COI);}CONiiprintstrD@A(D@Is);DB(DBKimscreen_setupDBLpDCHikmonochromeDCJ)iiprintstrDDH(DE@s);DCiiprintstrDFI(DGAs);iiprintstrDGN(DHFimscreen_setupDHGpDICietypeDIE);iiprintstrDIM(DJEs);iiprintstrDJO(DKGs);ieputlDMH(DMLimscreen_setupDMMpDNIieaddrDNK,DNOCL);iiprintstrDOI(E@As);iiprintstrE@K(EACs);ieputlECD(ECHimscreen_setupECIpEDEiemodeEDG,EDKCL);iiprintstrEEE(EEMs);iiprintstrEFG(EFOs);ieputlEHN(EIBimscreen_setupEICpEIOiepageEJA,EJECL);iiprintstrEJM(EKEs);iiprintstrEKO(ELGs);ieputlENF(ENJimscreen_setupENKpEOGifres_xEOI,EONCL);iiprintstrF@F(F@Ns);iiprintstrFAH(FB@s);ieputlFCO(FDCimscreen_setupFDDpFE@ifres_yFEB,FEGCL);iiprintstrFEO(FFGs);AK(FGHCM);}FGM
main"7294 N $"{ENEAikcursor_pos1>;iiprintstr2<(34s);iiprintstr3?(47s);DB(72imdetect_video73(7?&80irkernel_parameters81p92imscreen_setup94)){AK(:>CL);};4iiprintstr;8(<0s);DB(=?ilprint_error>0(>;ikdisk_reset><(?6imloader_setup?7.ikboot_driveA@D),A@Oildisk_errorsAAA,AALieTRUEAAN)){AK(AC@CL);}ACFiiprintstrACJ(ADBs);DB(AFDilprint_errorAFE(AG@isdisk_info_standardAGA(AHCimloader_setupAHD.ikboot_driveAIA,AIK&AJIindisk_geometryAJJ.iicylinderAKH,AL@&ALNindisk_geometryALO.ieheadAMM,ANA&ANOindisk_geometryAO@.igsectorAON),B@Eildisk_errorsB@M,BAHieTRUEBAJ)){AK(BBLCL);}BCBiiprintstrBCF(BCNs);iiprintstrBDM(BEEs);ieputlBFL(BG@imloader_setupBGA.iokernel_sectorsBGN,BHLCL);iiprintstrBID(BILs);DB(BKDilprint_errorBKE(BL@ilread_kernelBLA(BLL),BLNildisk_errorsBM@,BMKieTRUEBMM)){AK(BNOCL);}BOEiiprintstrBOI(C@As);ilstop_floppyCBA(CBL);iiprintstrCCB(CCJs);ikcursor_posCEL=CFFioget_cursor_posCFG(CGEirkernel_parametersCGFpCHGimscreen_setupCHI.iepageCIF);irkernel_parametersCINpCJOimscreen_setupCKA.ibxCKN=CKOikcursor_posCL@&CLKCL;irkernel_parametersCMFpCNGimscreen_setupCNI.ibyCOF=COG(COHikcursor_posCOICAD@DCL)&D@JCL;iiprintstrDAG(DAOs);ikrun_kernelDCH=DDB(DDCEP*DDI)(DDKikKERNEL_LINDDL);(DEJ*DEKikrun_kernelDEL)(DFG);iiprintstrDFN(DGFs);AK(DHKCM);}DI@