
print_welcome"1849 N $"{igprintf17(1=s);igprintf4>(54s);}72
die"1971 N $"{ihfprintf-(14igstderr15,1;s);ieexit3<(40CL);}45
file_size"2056 N $fptr"{ENniesize26,2:iiposition2<;iiposition38=40ifftell41(46iefptr47);iffseek4?(54iefptr55,59CM,5<iiSEEK_END5>);iesize6:=6>ifftell6?(74iefptr75);iffseek7=(82iefptr83,87iiposition89,91iiSEEK_SET93);AK(:6iesize:7);}:>
xopen"2239 N $filename"mode"{ieFILE25*2;iefptr2<;iefptr35=39iffopen3:(3?iifilename40,48iemode4:);DB(57iefptr58BL5<ieNULL5>){ihfprintf69(70igstderr71,77s,96iifilename98);iddie:5(:8);}:=AK(;6iefptr;7);};>
xmalloc"2438 N $size"{EP*1;idptr1<;idptr24=27(28EP*2>)igmalloc30(36iesize37);DB(44idptr45BL48ieNULL4:){ihfprintf55(5<igstderr5=,63s,8=iesize8?);iddie98(9;);}:0igmemset:3(:9idptr::,:=CM,;0iesize;2);AK(<2idptr<3);}<9
find_keyword"2647 N $line"{ENEAibi2:;ibi30=31CM;AO(3>ipoption_keywords3?[4>ibi4?]BM51ieNULL53){DB(61igstrstr62(68ieline69,6=ipoption_keywords6?[7>ibi7?])BM82ieNULL84)AK(93ibi94);ibi9?CD:0;}:5AK(;0-;1CL);};6
parse_filename"2838 N $line"{c*25ifwhere26;c*35iifilename36;ifwhere43=48igstrchr49(4?ieline50,54CP);DB(62ifwhere63BL68ieNULL6:){ihfprintf75(7<igstderr7=,83s);iddie;>(<1);}<6iifilename<9==1(=2c*=8)ihxmalloc=:(>1igstrlen>2(>8ifwhere>9));ifwhere?5CD?:;igstrcpy@OO(A@EiifilenameA@F,A@NifwhereAA@);DB(AANiifilenameAAO[ABGigstrlenABH(ABNiifilenameABO)-ACHCL]BLACKCL)iifilenameADC[ADKigstrlenADL(AEBiifilenameAEC)-AELCL]=AEOCM;AK(AFLiifilenameAFM);}AGH
parse_ulong"3231 N $line"{c*22ifwhere23;ifwhere2==32igstrchr33(39ieline3:,3>CP);DB(4<ifwhere4=BL52ieNULL54){ihfprintf5?(66igstderr67,6=s);ieexit:8(:<CL);};2ifwhere;7CD;<;AK(<9ieatol<:(<>ifwhere<?));}=8
parse_config"3455 N $fptr"{c*24ieline25;ENciokeywords_found3:;ieline4?=53(54c*5:)ihxmalloc5<(63CL);iokeywords_found6;=79CM;AO(86!87iefeof88(8<iefptr8=)){iffgets99(9>ieline9?,:3CL,:8iefptr::);DB(;9ihisalnum;:(<1ieline<2[<6CM])){AL(=9imfind_keyword=:(>6ieline>7)){AB-?<CL:ihfprintfA@@(A@GigstderrA@H,A@Ns,ACFielineACH);AA;ABCM:inboot_filenameAFA=AFNioparse_filenameAFO(AGMielineAGN);igprintfAHL(AIBs,AKNinboot_filenameAL@);iokeywords_foundAMGCDANE;AA;ABCL:iploader_filenameB@J=BAIioparse_filenameBAJ(BBHielineBBI);igprintfBCG(BCMs,BFIiploader_filenameBFK);iokeywords_foundBHGCDBIE;AA;ABCL:ipkernel_filenameBKD=BLCioparse_filenameBLD(BMBielineBMC);igprintfBNA(BNGs,CACipkernel_filenameCAE);iokeywords_foundCCACDCCO;AA;ABCL:ipoutput_filenameCFD=CGCioparse_filenameCGD(CHBielineCHC);igprintfCIA(CIGs,CLCipoutput_filenameCLE);iokeywords_foundCMNCDCNL;AA;ABCL:iooutput_sectorsD@K=DAIilparse_ulongDAJ(DBEielineDBF);igprintfDCD(DCJs,DFGiooutput_sectorsDFI);iokeywords_foundDHACDDHO;AA;ABCL:ikboot_setupFAM.iqbytes_per_sectorFBH=FCHilparse_ulongFCI(FDDielineFDE);igprintfFEC(FEIs,FHEikboot_setupFHG.iqbytes_per_sectorFIB);iokeywords_foundFJLCDFKJ;AA;AD:ihfprintfFNA(FNHigstderrFNI,FNOs,GAEielineGAG);AA;}GBO}GCD}GCGiefreeGCM(GDAielineGDB);igprintfGDK(GEAs);DB(GEMiokeywords_foundGENBMGFLiikeywordsGFN){ihfprintfGGM(GHDigstderrGHE,GHKs);iddieGLA(GLD);}GLI}GLM
byte_to_sector"5469 N $byte_offset"{ENEAidtmp3;;idtmp42=45ilbyte_offset46/51ikboot_setup52.iqbytes_per_sector5=;DB(75(76ilbyte_offset77%82ikboot_setup83.iqbytes_per_sector8>)>9?CM)idtmp:5BC:8CL;AK(;6idtmp;7);};=
main"5665 N $argc"argv"{ieFILE20*27ilconfig_file28,33*35ijboot_file36,3?*41illoader_file42,4=*4?ilkernel_file50,5;*5=iloutput_file5>;ENEAiesize7:,7>iktotal_size80,8:ibi8<;ENcihpadding9>=:6CM;igbuffer:>=;4(;5ENc*<4)ihxmalloc<6(<=CL);inprint_welcomeADD(AEA);DB(AEJieargcAEK>AEOCLBKAFB!AFEigstrcmpAFF(AFLieargvAFM[AGACL],AGDs))ihpaddingAGO=AHFCL;ilconfig_fileAJO=AKJifxopenAKK(AL@s,ALKs);igprintfAME(AMKs);imparse_configAOJ(B@Filconfig_fileB@G);ijboot_fileBDK=BEDifxopenBEE(BEJinboot_filenameBEK,BFHs);igprintfBGB(BGHs,BICinboot_filenameBID);iesizeBJE=BJIijfile_sizeBJJ(BKCijboot_fileBKD);DB(BLDiesizeBLE>BLICL){ihfprintfBMD(BMKigstderrBML,BNBs);iddieCAI(CAL);}CBAiffreadCBD(CBIigbufferCBJ,CC@iesizeCCB,CCFCL,CCIijboot_fileCCK);DB(CDK!CDL(CDM(CDNigbufferCDO[CEECL]BLCEJCL)BKCFB(CFEigbufferCFF[CFLCL]BLCGACL))){ihfprintfCH@(CHGigstderrCHH,CHNs);iddieCLA(CLD);}CLIikboot_setupCLL.imboot_sectorsCMG=CNCiobyte_to_sectorCND(COBiesizeCOC);iktotal_sizeCOK=D@EiesizeD@F;igfcloseD@M(DACijboot_fileDAD);ikboot_setupDBB.imloader_startDBM=DCIiobyte_to_sectorDCJ(DDHiktotal_sizeDDI);illoader_fileDHM=DIHifxopenDII(DINiploader_filenameDIO,DJNs);igprintfDKH(DKNs,DNBiploader_filenameDND);iesizeDOG=DOKijfile_sizeDOL(E@Eilloader_fileE@F);iffreadEAE(EAJ&EAKigbufferEAL[EBBiktotal_sizeEBC],EBNiesizeEC@,ECDCL,ECGilloader_fileECI);igfcloseEDH(EDNilloader_fileEDO);iktotal_sizeEF@BCEFJiesizeEFL;ikboot_setupEGC.ioloader_sectorsEGN=EHLiobyte_to_sectorEHM(EIKiesizeEIL);ikboot_setupEJD.ikboot_driveEJO=EKICM;ikboot_setupEKN.imkernel_startELI=EMEiobyte_to_sectorEMF(ENDiktotal_sizeENE);igmemsetEOD(EOJ&EOKigbufferEOL[F@Biktotal_sizeF@C],F@NCM,FAA(FACikboot_setupFAD.imkernel_startFAO*FBKCL)-FC@iktotal_sizeFCA);iktotal_sizeFCO=FDIikboot_setupFDJ.imkernel_startFEE*FFACL;ilkernel_fileFIN=FJIifxopenFJJ(FJOipkernel_filenameFK@,FKOs);igprintfFLI(FLOs,FNLipkernel_filenameFNN);iesizeG@A=G@Eijfile_sizeG@F(G@Oilkernel_fileGA@);iffreadGAO(GBD&GBEigbufferGBF[GBLiktotal_sizeGBM],GCHiesizeGCJ,GCNCL,GDAilloader_fileGDC);igfcloseGEB(GEHilkernel_fileGEI);iktotal_sizeGFIBCGGCiesizeGGE;ikboot_setupGGM.imloader_startGHHCDGID;ikboot_setupGII.imkernel_startGJDCDGK@;ikboot_setupGKE.iokernel_sectorsGL@=GLNiobyte_to_sectorGLO(GMMiesizeGMN);igprintfGNG(GNMs);igmemcpyH@M(HAC&HADigbufferHAE[HAKCL],HAN&HB@ikboot_setupHBA,HBKCF(HCCikboot_setupHCD));igprintfHMO(HNEs,IABikboot_setupIAD.iqbytes_per_sectorIAO);igprintfICC(ICIs,IFGikboot_setupIFI.imboot_sectorsIGD);igprintfIHD(IHJs,IKGikboot_setupIKI.imloader_startILD);igprintfIMD(IMJs,J@Gikboot_setupJ@I.ioloader_sectorsJAD);igprintfJBG(JBMs,JEJikboot_setupJEL.imkernel_startJFG);igprintfJGG(JGMs,JJJikboot_setupJJL.iokernel_sectorsJKG);igprintfJLK(JMAs,JNMiktotal_sizeJNO,JOIipoutput_filenameJOK);iloutput_fileK@N=KAIifxopenKAJ(KAOipoutput_filenameKB@,KBOs);igfwriteKCI(KCOigbufferKD@,KDFiktotal_sizeKDI,KECCL,KEFiloutput_fileKEH);DB(KFKihpaddingKFL){igprintfKGJ(KH@s,KII(KIKiooutput_sectorsKIL*KJJCL));AG(KKGibiKKH=KKIiktotal_sizeKKJ;ibiKLF<KLGiooutput_sectorsKLH*KMFCL;ibiKMLCDKMM)iffputcKND(KNICM,KNKiloutput_fileKNM);}KOLigfcloseL@@(L@Filoutput_fileL@G);iefreeLAF(LAJigbufferLAK);igprintfLBF(LBLs);AKCM;}LFB